#!/usr/bin/env node

var _             = require('underscore');
var repl          = require('repl');
var path          = require('path');
var program       = require('commander');
var blessed       = require('blessed');
var bootstrap     = require('../src/bootstrap');
var UserInterface = require('../src/ui');
var Application   = require('../src/app/main');
var configFile    = path.resolve(process.env.HOME, './.qi.json');

program
  .version('2.0.0')
  .option('--clear-cache', 'Clears the cache')
  .parse(process.argv);

process.title = 'qissues';

var container = bootstrap(configFile);

if(program.clearCache) {
  container.get('cache').invalidateAll();
}

var r = repl.start({
  prompt: 'qui> ',
  input: process.stdin,
  output: process.stdout,
  useGlobal: true
});

r.context.container = container;
r.context.dump = function(data) {
  console.log(JSON.stringify(_.invoke(data, 'serialize'), null, 2));
};
